!function(e){function t(t){for(var n,r,a=t[0],c=t[1],i=0,s=[];i<a.length;i++)r=a[i],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&s.push(o[r][0]),o[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(l&&l(t);s.length;)s.shift()()}var n={},o={0:0};var r={};var a={5:function(){return{"./index_bg.js":{__wbindgen_object_drop_ref:function(e){return n[2].exports.md(e)},__wbindgen_object_clone_ref:function(e){return n[2].exports.ld(e)},__wbg_localmediatrack_new:function(e){return n[2].exports.Gb(e)},__wbindgen_string_get:function(e,t){return n[2].exports.nd(e,t)},__wbg_connectionhandle_new:function(e){return n[2].exports.S(e)},__wbindgen_number_new:function(e){return n[2].exports.kd(e)},__wbg_remotemediatrack_new:function(e){return n[2].exports.lc(e)},__wbg_roomclosereason_new:function(e){return n[2].exports.qc(e)},__wbg_reconnecthandle_new:function(e){return n[2].exports.kc(e)},__wbindgen_string_new:function(e,t){return n[2].exports.od(e,t)},__wbindgen_cb_drop:function(e){return n[2].exports.Wc(e)},__wbg_internalexception_new:function(e){return n[2].exports.zb(e)},__wbg_localmediainitexception_new:function(e){return n[2].exports.Fb(e)},__wbg_mediasettingsupdateexception_new:function(e){return n[2].exports.Kb(e)},__wbg_mediastatetransitionexception_new:function(e){return n[2].exports.Lb(e)},__wbg_formatexception_new:function(e){return n[2].exports.gb(e)},__wbg_rpcclientexception_new:function(e){return n[2].exports.rc(e)},__wbg_stateerror_new:function(e){return n[2].exports.Hc(e)},__wbg_enumeratedevicesexception_new:function(e){return n[2].exports.cb(e)},__wbindgen_is_undefined:function(e){return n[2].exports.hd(e)},__wbg_mediadevicedetails_new:function(e){return n[2].exports.Jb(e)},__wbindgen_number_get:function(e,t){return n[2].exports.jd(e,t)},__wbg_crypto_70a96de3b6b73dac:function(e){return n[2].exports.V(e)},__wbindgen_is_object:function(e){return n[2].exports.fd(e)},__wbg_process_dd1577445152112e:function(e){return n[2].exports.fc(e)},__wbg_versions_58036bec3add9e6f:function(e){return n[2].exports.Tc(e)},__wbg_node_6a9d28205ed5b0d8:function(e){return n[2].exports.dc(e)},__wbindgen_is_string:function(e){return n[2].exports.gd(e)},__wbg_msCrypto_adbc770ec9eca9c7:function(e){return n[2].exports.Ob(e)},__wbg_require_f05d779769764e82:function(){return n[2].exports.oc()},__wbindgen_is_function:function(e){return n[2].exports.ed(e)},__wbg_getRandomValues_3774744e221a22ad:function(e,t){return n[2].exports.jb(e,t)},__wbg_randomFillSync_e950366c42764a07:function(e,t){return n[2].exports.hc(e,t)},__wbg_new_abda76e883ba8a5f:function(){return n[2].exports.Ub()},__wbg_stack_658279fe44541cf6:function(e,t){return n[2].exports.Gc(e,t)},__wbg_error_f851667af71bcfc6:function(e,t){return n[2].exports.db(e,t)},__wbg_instanceof_Window_e266f02eee43b570:function(e){return n[2].exports.yb(e)},__wbg_navigator_b18e629f7f0b75fa:function(e){return n[2].exports.Pb(e)},__wbg_setTimeout_6609c9aa64f32bfc:function(e,t,o){return n[2].exports.Ac(e,t,o)},__wbg_debug_7960d327fd96f71a:function(e,t,o,r){return n[2].exports.X(e,t,o,r)},__wbg_error_fe807da27c4a4ced:function(e){return n[2].exports.fb(e)},__wbg_error_fd84ca2a8a977774:function(e,t,o,r){return n[2].exports.eb(e,t,o,r)},__wbg_info_5566be377f5b52ae:function(e,t,o,r){return n[2].exports.wb(e,t,o,r)},__wbg_log_7b690f184ae4519b:function(e,t,o,r){return n[2].exports.Hb(e,t,o,r)},__wbg_warn_48cbddced45e5414:function(e,t,o,r){return n[2].exports.Uc(e,t,o,r)},__wbg_now_c644db5194be8437:function(e){return n[2].exports.ec(e)},__wbg_enumerateDevices_0764d63719438d2c:function(e){return n[2].exports.bb(e)},__wbg_getDisplayMedia_ede316aaf9ba759d:function(e,t){return n[2].exports.ib(e,t)},__wbg_getUserMedia_701163d4ef4b0bff:function(e,t){return n[2].exports.ob(e,t)},__wbg_code_9743a5678b87b9e9:function(e){return n[2].exports.R(e)},__wbg_reason_8585c102803c11b5:function(e,t){return n[2].exports.jc(e,t)},__wbg_replaceTrack_cc380644f2d9a86b:function(e,t){return n[2].exports.nc(e,t)},__wbg_track_6c1e5e546d6ea5f6:function(e){return n[2].exports.Pc(e)},__wbg_transceiver_82e6f5e1508907ad:function(e){return n[2].exports.Qc(e)},__wbg_data_af909e5dfe73e68c:function(e){return n[2].exports.W(e)},__wbg_candidate_6713293ca384490f:function(e){return n[2].exports.N(e)},__wbg_kind_afddce9b173e66d7:function(e,t){return n[2].exports.Db(e,t)},__wbg_id_dba654cb4890882e:function(e,t){return n[2].exports.vb(e,t)},__wbg_setenabled_1459ab00e4867caf:function(e,t){return n[2].exports.Fc(e,t)},__wbg_readyState_4fbf25bece7a1772:function(e){return n[2].exports.ic(e)},__wbg_clone_275ec7dfffd53482:function(e){return n[2].exports.O(e)},__wbg_getSettings_e501304b4583831f:function(e){return n[2].exports.kb(e)},__wbg_stop_48ebbc51514ffed4:function(e){return n[2].exports.Ic(e)},__wbg_iceConnectionState_4027aaedd6c0598d:function(e){return n[2].exports.ub(e)},__wbg_newwithconfiguration_8a4c8568e8d4666b:function(e){return n[2].exports.Zb(e)},__wbg_addIceCandidate_98c76f96c1850ea4:function(e,t){return n[2].exports.H(e,t)},__wbg_addTransceiver_86573504875675a5:function(e,t,o,r){return n[2].exports.I(e,t,o,r)},__wbg_close_07bb5fdad9a8467a:function(e){return n[2].exports.P(e)},__wbg_createAnswer_c180806649ebb9aa:function(e){return n[2].exports.T(e)},__wbg_createOffer_f2cf2b3692358c98:function(e,t){return n[2].exports.U(e,t)},__wbg_getStats_07bc54a9144109ac:function(e){return n[2].exports.lb(e)},__wbg_getTransceivers_260625153aac68ce:function(e){return n[2].exports.nb(e)},__wbg_setLocalDescription_95c37b91edebcd99:function(e,t){return n[2].exports.yc(e,t)},__wbg_setRemoteDescription_dc51fc8f9f08b74b:function(e,t){return n[2].exports.zc(e,t)},__wbg_getTracks_56c90db8f141d5e5:function(e){return n[2].exports.mb(e)},__wbg_candidate_5807aafabae3b03d:function(e,t){return n[2].exports.M(e,t)},__wbg_sdpMid_898ed52df83cc609:function(e,t){return n[2].exports.tc(e,t)},__wbg_sdpMLineIndex_e7cad148140a916d:function(e){return n[2].exports.sc(e)},__wbg_sdp_869cbbd7bb8216d2:function(e,t){return n[2].exports.uc(e,t)},__wbg_mediaDevices_633a6d16702659d4:function(e){return n[2].exports.Ib(e)},__wbg_mid_79904cc6b0bdf6bf:function(e,t){return n[2].exports.Nb(e,t)},__wbg_sender_9f0148ba7d7294df:function(e){return n[2].exports.xc(e)},__wbg_stopped_5d6b767f0b3538e6:function(e){return n[2].exports.Jc(e)},__wbg_direction_3d9e8e43347f8bcb:function(e){return n[2].exports.Z(e)},__wbg_setdirection_9aaebf4846b11032:function(e,t){return n[2].exports.Ec(e,t)},__wbg_new_8ad026ef33da9ab1:function(e,t){return n[2].exports.Sb(e,t)},__wbg_close_3a962d99983f8e2e:function(e,t,o,r){return n[2].exports.Q(e,t,o,r)},__wbg_send_36f8bcb566f8afa0:function(e,t,o){return n[2].exports.wc(e,t,o)},__wbg_addEventListener_615d4590d38da1c9:function(e,t,o,r){return n[2].exports.G(e,t,o,r)},__wbg_removeEventListener_86fd19ed073cd1ed:function(e,t,o,r){return n[2].exports.mc(e,t,o,r)},__wbg_deviceId_02205c89181de681:function(e,t){return n[2].exports.Y(e,t)},__wbg_kind_0ae489680ad9d512:function(e){return n[2].exports.Cb(e)},__wbg_label_cc748068a0fcf66b:function(e,t){return n[2].exports.Eb(e,t)},__wbg_groupId_ebf5c2cbbc25d6a9:function(e,t){return n[2].exports.tb(e,t)},__wbg_get_27fe3dac1c4d0224:function(e,t){return n[2].exports.pb(e,t)},__wbg_new_b525de17f44a8943:function(){return n[2].exports.Vb()},__wbg_newnoargs_2b8b6bd7753c76ba:function(e,t){return n[2].exports.Xb(e,t)},__wbg_next_b7d530c04fd8b217:function(e){return n[2].exports.cc(e)},__wbg_next_88560ec06a094dea:function(e){return n[2].exports.bc(e)},__wbg_done_1ebec03bbd919843:function(e){return n[2].exports.ab(e)},__wbg_value_6ac8da5cc5b3efda:function(e){return n[2].exports.Rc(e)},__wbg_iterator_55f114446221aa5a:function(){return n[2].exports.Bb()},__wbg_get_baf4855f9a986186:function(e,t){return n[2].exports.qb(e,t)},__wbg_call_95d1ea488d03e4e8:function(e,t){return n[2].exports.L(e,t)},__wbg_new_f9876326328f45ed:function(){return n[2].exports.Wb()},__wbg_self_e7c1f827057f6584:function(){return n[2].exports.vc()},__wbg_window_a09ec664e14b1b81:function(){return n[2].exports.Vc()},__wbg_globalThis_87cbb8506fecf3a9:function(){return n[2].exports.rb()},__wbg_global_c85a9259e621f3db:function(){return n[2].exports.sb()},__wbg_from_67ca20fa722467e6:function(e){return n[2].exports.hb(e)},__wbg_push_49c286f04dd3bf59:function(e,t){return n[2].exports.gc(e,t)},__wbg_values_97683218f24ed826:function(e){return n[2].exports.Sc(e)},__wbg_instanceof_Error_749a7378f4439ee0:function(e){return n[2].exports.xb(e)},__wbg_new_15d3966e9981a196:function(e,t){return n[2].exports.Qb(e,t)},__wbg_message_a95c3ef248e4b57a:function(e){return n[2].exports.Mb(e)},__wbg_toString_cec163b212643722:function(e){return n[2].exports.Oc(e)},__wbg_call_9495de66fdbe016b:function(e,t,o){return n[2].exports.K(e,t,o)},__wbg_is_8f1618fe9a4fd388:function(e,t){return n[2].exports.Ab(e,t)},__wbg_new_9d3a9ce4282a18a8:function(e,t){return n[2].exports.Tb(e,t)},__wbg_resolve_fd40f858d9db1a04:function(e){return n[2].exports.pc(e)},__wbg_then_ec5db6d509eb475f:function(e,t){return n[2].exports.Mc(e,t)},__wbg_then_f753623316e2873a:function(e,t,o){return n[2].exports.Nc(e,t,o)},__wbg_buffer_cf65c07de34b9a08:function(e){return n[2].exports.J(e)},__wbg_newwithbyteoffsetandlength_9fb2f11355ecadf5:function(e,t,o){return n[2].exports.Yb(e,t,o)},__wbg_new_537b7341ce90bb31:function(e){return n[2].exports.Rb(e)},__wbg_set_17499e8aa4003ebd:function(e,t,o){return n[2].exports.Bc(e,t,o)},__wbg_newwithlength_b56c882b57805732:function(e){return n[2].exports.ac(e)},__wbg_subarray_7526649b91a252a6:function(e,t,o){return n[2].exports.Lc(e,t,o)},__wbg_set_6aa458a4ebdb65cb:function(e,t,o){return n[2].exports.Cc(e,t,o)},__wbg_stringify_029a979dfb73aa17:function(e){return n[2].exports.Kc(e)},__wbindgen_debug_string:function(e,t){return n[2].exports.dd(e,t)},__wbindgen_throw:function(e,t){return n[2].exports.pd(e,t)},__wbindgen_memory:function(){return n[2].exports.id()},__wbindgen_closure_wrapper1031:function(e,t,o){return n[2].exports.Xc(e,t,o)},__wbindgen_closure_wrapper1032:function(e,t,o){return n[2].exports.Yc(e,t,o)},__wbindgen_closure_wrapper1033:function(e,t,o){return n[2].exports.Zc(e,t,o)},__wbindgen_closure_wrapper1037:function(e,t,o){return n[2].exports.ad(e,t,o)},__wbindgen_closure_wrapper1039:function(e,t,o){return n[2].exports.bd(e,t,o)},__wbindgen_closure_wrapper3660:function(e,t,o){return n[2].exports.cd(e,t,o)}}}}};function c(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,c),o.l=!0,o.exports}c.e=function(e){var t=[],n=o[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise((function(t,r){n=o[e]=[t,r]}));t.push(n[2]=i);var s,d=document.createElement("script");d.charset="utf-8",d.timeout=120,c.nc&&d.setAttribute("nonce",c.nc),d.src=function(e){return c.p+""+e+".bundle.js"}(e);var l=new Error;s=function(t){d.onerror=d.onload=null,clearTimeout(_);var n=o[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",l.name="ChunkLoadError",l.type=r,l.request=a,n[1](l)}o[e]=void 0}};var _=setTimeout((function(){s({type:"timeout",target:d})}),12e4);d.onerror=d.onload=s,document.head.appendChild(d)}return({1:[5]}[e]||[]).forEach((function(e){var n=r[e];if(n)t.push(n);else{var o,i=a[e](),s=fetch(c.p+""+{5:"f32388a580fff4701bcd"}[e]+".module.wasm");if(i instanceof Promise&&"function"==typeof WebAssembly.compileStreaming)o=Promise.all([WebAssembly.compileStreaming(s),i]).then((function(e){return WebAssembly.instantiate(e[0],e[1])}));else if("function"==typeof WebAssembly.instantiateStreaming)o=WebAssembly.instantiateStreaming(s,i);else{o=s.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,i)}))}t.push(r[e]=o.then((function(t){return c.w[e]=(t.instance||t).exports})))}})),Promise.all(t)},c.m=e,c.c=n,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)c.d(n,o,function(t){return e[t]}.bind(null,o));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="",c.oe=function(e){throw console.error(e),e},c.w={};var i=window.webpackJsonp=window.webpackJsonp||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var d=0;d<i.length;d++)t(i[d]);var l=s;c(c.s=0)}([function(e,t,n){const o=document.location.protocol+"//"+document.location.host,r=o+"/control-api/",a="ws://"+document.location.host+":8080/ws/";let c,i=window.location.hash.replace("#",""),s={},d=document.getElementById("connection-settings__connect"),l=document.getElementById("connection-settings__username"),_=document.getElementById("username-menu-button"),u=document.getElementById("control__disable_audio_send"),b=document.getElementById("control__disable_video_send"),p=document.getElementById("control__disable_audio_recv"),f=document.getElementById("control__disable_video_recv"),g=document.getElementById("control__mute_audio_send"),m=document.getElementById("control__mute_video_send"),w=document.getElementById("control__close_app"),y=document.getElementById("connect__select-device_audio"),x=document.getElementById("connect__select-device_video"),v=document.getElementById("connection-settings__screenshare"),h=document.getElementById("local-video");const E={replacer:function(e,t,n,o,r){let a=t||"";return n&&(a=a+'<span class="json__key">'+n.replace(/[': ]/g,"")+"</span>: "),o&&(a=a+('"'===o[0]?'<span class="json__string">':'<span class="json__value">')+o+"</span>"),a+(r||"")},prettyPrint:function(e){return JSON.stringify(e,null,3).replace(/&/g,"&amp;").replace(/\\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/^( *)("[\w\-]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/gm,E.replacer)}},k={createEndpoint:function(){let e=document.getElementById("control-debug__window_create_endpoint"),t=e.getElementsByClassName("webrtc-publish-endpoint-spec")[0],n=e.getElementsByClassName("webrtc-play-endpoint-spec")[0],o=e.getElementsByClassName("control-debug__endpoint-type")[0];o.addEventListener("change",()=>{switch(o.value){case"WebRtcPlayEndpoint":$(n).show(),$(t).hide();break;case"WebRtcPublishEndpoint":$(t).show(),$(n).hide()}}),e.getElementsByClassName("control-debug__execute")[0].addEventListener("click",async()=>{let t=e.getElementsByClassName("control-debug__id_room")[0].value,n=e.getElementsByClassName("control-debug__id_member")[0].value,o=e.getElementsByClassName("control-debug__id_endpoint")[0].value,r=e.getElementsByClassName("control-debug__endpoint-type")[0].value;if("WebRtcPublishEndpoint"===r){let a=e.getElementsByClassName("webrtc-publish-endpoint-spec__p2p")[0].value,c=document.getElementById("webrtc-publish-endpoint-spec__force-relay").checked,i=document.getElementsByClassName("webrtc-publish-endpoint-spec__publish-policy_audio")[0].value,s=document.getElementsByClassName("webrtc-publish-endpoint-spec__publish-policy_video")[0].value;await N.createEndpoint(t,n,o,{kind:r,p2p:a,force_relay:c,audio_settings:{publish_policy:i},video_settings:{publish_policy:s}})}else if("WebRtcPlayEndpoint"===r){let a="local://"+e.getElementsByClassName("webrtc-play-endpoint-spec__src")[0].value,c=document.getElementById("webrtc-play-endpoint-spec__force-relay").checked;await N.createEndpoint(t,n,o,{kind:r,src:a,force_relay:c})}})},delete:function(){let e=document.getElementById("control-debug__window_delete");e.getElementsByClassName("control-debug__execute")[0].addEventListener("click",async()=>{let t=e.getElementsByClassName("control-debug__id_room")[0].value,n=e.getElementsByClassName("control-debug__id_member")[0].value,o=e.getElementsByClassName("control-debug__id_endpoint")[0].value;await N.delete(t,n,o)})},createRoom:function(){let e=document.getElementById("control-debug__window_create_room");e.getElementsByClassName("control-debug__execute")[0].addEventListener("click",async()=>{let t=e.getElementsByClassName("control-debug__id_room")[0].value;await N.createRoom(t)})},createMember:function(){let e=document.getElementById("control-debug__window_create_member");e.getElementsByClassName("control-debug__execute")[0].addEventListener("click",async()=>{let t=e.getElementsByClassName("control-debug__id_room")[0].value,n=e.getElementsByClassName("control-debug__id_member")[0].value,o=e.getElementsByClassName("member-spec__credentials")[0].value,r=e.getElementsByClassName("member-spec__idle-timeout")[0].value,a=e.getElementsByClassName("member-spec__reconnect-timeout")[0].value,c=e.getElementsByClassName("member-spec__ping-interval")[0].value,i={};o.length>0&&(i.credentials=o),r.length>0&&(i.idle_timeout=r),a.length>0&&(i.reconnect_timeout=a),c.length>0&&(i.ping_interval=c),await N.createMember(t,n,i)})},get:function(){let e=document.getElementById("control-debug__window_get"),t=e.getElementsByClassName("control-debug__json-result")[0];e.getElementsByClassName("control-debug__execute")[0].addEventListener("click",async()=>{let n=e.getElementsByClassName("control-debug__id_room")[0].value,o=e.getElementsByClassName("control-debug__id_member")[0].value,r=e.getElementsByClassName("control-debug__id_endpoint")[0].value,a=await N.get(n,o,r);t.innerHTML=E.prettyPrint(a)})},callbacks:function(){let e=document.getElementById("control-debug__window_callbacks"),t=e.getElementsByClassName("control-debug__table-result")[0];e.getElementsByClassName("control-debug__execute")[0].addEventListener("click",async()=>{for(;t.firstChild;)t.firstChild.remove();let e=await N.getCallbacks(),n=document.createElement("table");n.className="table";let o=document.createElement("thead"),r=document.createElement("tr"),a=document.createElement("th");a.innerHTML="Event",a.scope="col",r.appendChild(a);let c=document.createElement("th");c.innerHTML="Time",c.scope="col",r.appendChild(c);let i=document.createElement("th");i.innerHTML="FID",i.scope="col",r.appendChild(i),o.appendChild(r),n.appendChild(o);let s=document.createElement("tbody");for(callback of e){let e=document.createElement("tr"),t=document.createElement("td");t.innerHTML=JSON.stringify(callback.event),e.appendChild(t);let n=document.createElement("td");n.innerHTML=callback.at,e.appendChild(n);let o=document.createElement("td");o.innerHTML=callback.fid,e.appendChild(o),s.appendChild(e)}n.appendChild(s),t.appendChild(n)})}};async function C(){let e=l.value,t=await N.get(i,"",""),n=Object.values(t.element.pipeline),o=[];n.forEach(t=>{t.id!=e&&o.push(t.id)});await N.createEndpoint(i,e,"publish",{kind:"WebRtcPublishEndpoint",p2p:"Never"})&&o.forEach(async t=>{let n={kind:"WebRtcPlayEndpoint",src:`local://${i}/${e}/publish`,force_relay:!1};await N.createEndpoint(i,t,"play-"+e,n)})}async function B(e){for(const t of e){if(t.kind()===c.MediaKind.Audio)continue;let e=new MediaStream;if(e.addTrack(t.get_track()),t.media_source_kind()===c.MediaSourceKind.Display){let t=h.getElementsByClassName("local-display-video")[0];void 0===t&&(t=document.createElement("video"),t.className="local-display-video",t.width=200,t.autoplay="true",h.appendChild(t)),t.srcObject=e}else{let t=h.getElementsByClassName("local-device-video")[0];void 0===t&&(t=document.createElement("video"),t.className="local-device-video",t.width=200,t.autoplay="true",h.appendChild(t)),t.srcObject=e}}}window.onload=async function(){c=await n.e(1).then(n.bind(null,1));let e=new c.Jason;console.log(a),l.addEventListener("change",e=>{_.innerHTML=e.target.value}),$(".modal").on("show.bs.modal",(function(e){var t=$(".modal:visible").length;$(this).css("z-index",1040+10*t)})),$(".modal").on("shown.bs.modal",(function(e){var t=$(".modal:visible").length-1;$(".modal-backdrop").not(".stacked").css("z-index",1039+10*t),$(".modal-backdrop").not(".stacked").addClass("stacked")})),$("#connection-settings").modal("show"),document.getElementById("enable-publishing-btn").addEventListener("click",async()=>{await C()}),Object.values(k).forEach(e=>e());let t=!1,o=[],h=!0,E=!0,N=!0,M=!0,L=!1,S=!1,I=await async function(){let n=e.init_room();try{const t=await T();await async function(t,n,r){let a="disable",i="disable";for(const e of o)e.kind()===c.MediaKind.Video?i=e.get_track().label||"disable":a=e.get_track().label||"disable";const s=await e.media_manager().enumerate_devices();console.log("Available input and output devices:",s);for(const e of s){const o=document.createElement("option");o.value=e.device_id(),e.kind()===c.MediaKind.Audio?(o.text=e.label()||"Microphone "+(t.length+1),o.selected=o.text===a,t.append(o)):e.kind()===c.MediaKind.Video&&(o.text=e.label()||"Camera "+(n.length+1),o.selected=o.text===i,n.append(o))}const d=document.createElement("option");d.value="screen",d.text="screen",n.append(d);const l=document.createElement("option");l.value="facingModeUser",l.text="Facing user",n.append(l);const _=document.createElement("option");_.value="facingModeEnvironment",_.text="Facing environment",n.append(_)}(y,x),await n.set_local_media_settings(t,!1,!1)}catch(e){console.error("Init local video failed: "+e)}return n.on_new_connection(e=>{let n=e.get_remote_member_id();t=!0;let o=s[n],r=document.getElementsByClassName("remote-videos")[0];void 0===o&&(o=document.createElement("div"),o.classList.add("video"),o.classList.add("d-flex"),o.classList.add("flex-column"),o.classList.add("align-items-center"),o.style="margin: 10px",r.appendChild(o),s[n]=o);let a=document.createElement("span");a.innerHTML=n,a.classList.add("member-id"),a.classList.add("order-4"),o.appendChild(a),e.on_quality_score_update(e=>{let t=o.getElementsByClassName("quality-score")[0];void 0===t&&(t=document.createElement("span"),t.classList.add("quality-score"),t.classList.add("order-5"),o.appendChild(t)),t.innerHTML=e}),e.on_remote_track_added(e=>{let t=void 0;if(e.kind()===c.MediaKind.Video)if(e.media_source_kind()===c.MediaSourceKind.Display){t=o.getElementsByClassName("display-video")[0],void 0===t&&(t=document.createElement("video"),t.classList.add("display-video"),t.classList.add("order-2"),t.playsinline="true",t.controls="true",t.autoplay="true",0!=e.media_direction()&&(t.pause(),t.style.display="none"),o.appendChild(t));let n=new MediaStream;n.addTrack(e.get_track()),t.srcObject=n}else{t=o.getElementsByClassName("camera-video")[0],void 0===t&&(t=document.createElement("video"),t.className="camera-video",t.classList.add("camera-video"),t.classList.add("order-1"),t.playsinline="true",t.controls="true",t.autoplay="true",0!=e.media_direction()&&(t.pause(),t.style.display="none"),o.appendChild(t));let n=new MediaStream;n.addTrack(e.get_track()),t.srcObject=n}else{t=o.getElementsByClassName("audio")[0],void 0===t&&(t=document.createElement("audio"),t.className="audio",t.classList.add("audio"),t.classList.add("order-3"),t.controls="true",t.autoplay="true",0!=e.media_direction()&&(t.pause(),t.style.display="none"),o.appendChild(t));let n=new MediaStream;n.addTrack(e.get_track()),t.srcObject=n}e.on_media_direction_changed(async e=>{console.log("New TransceiverDirection: "+e),0==e?(await t.play(),t.style.display="block"):(t.pause(),t.style.display="none")}),e.on_muted(()=>{console.log("Track muted: "+e.kind())}),e.on_unmuted(()=>{console.log("Track unmuted: "+e.kind())}),e.on_stopped(()=>{console.error("on stopped"),console.dir(e),e.free(),t.remove()})}),e.on_close(()=>{console.error("on close"),console.dir(e),s[n].remove(),delete s[n]})}),n.on_local_track(e=>{console.log("New local track"),B([e]),e.free()}),n.on_failed_local_media(e=>{console.error(e.message())}),n.on_connection_loss(async e=>{let t=document.getElementsByClassName("connection-loss-notification")[0];$(t).toast("show");let n=document.getElementsByClassName("connection-loss-notification__manual-reconnect")[0],o=document.getElementsByClassName("connection-loss-notification__msg")[0],r=o.textContent;n.onclick=async()=>{try{o.textContent="Trying to manually reconnect...",await e.reconnect_with_delay(0),$(t).toast("hide"),console.log("Reconnected!")}catch(e){console.error("Failed to manually reconnect: "+e.message())}finally{o.textContent=r}};try{await e.reconnect_with_backoff(500,2,5e3,null)}catch(e){console.error("Error in reconnection with backoff:\n"+e.message())}$(t).toast("hide")}),n.on_close((async function(e){let t=document.getElementsByClassName("remote-videos")[0];for(;t.firstChild;)t.firstChild.remove();$("#connection-settings").modal("show"),$("#connect-btn").show(),$(".control").hide(),alert(`Call was ended.\n        Reason: ${e.reason()};\n        Is closed by server: ${e.is_closed_by_server()};\n        Is error: ${e.is_err()}.`)})),n}();async function T(){let t=await O(h?y:null,E?x:null);try{o=await e.media_manager().init_local_tracks(t)}catch(n){let r=n.cause();if(!r||"NotReadableError"!==r.name&&"AbortError"!==r.name)throw n;if(r.message.includes("audio"))t=await O(null,x),o=await e.media_manager().init_local_tracks(t),alert("unable to get audio, will try to enter room with video only");else{if(!r.message.includes("video"))throw n;t=await O(y,null),o=await e.media_manager().init_local_tracks(t),alert("unable to get video, will try to enter room with audio only")}}return await B(o),t}async function O(e,t){let n=new c.MediaStreamSettings;if(null!=e){let t=new c.AudioTrackConstraints,o=e.options[e.selectedIndex];o&&t.device_id(o.value),n.audio(t)}if(null!=t){let e=t.options[t.selectedIndex];if(e)if("screen"===e.value){let e=new c.DisplayVideoTrackConstraints;n.display_video(e)}else{let t=new c.DeviceVideoTrackConstraints;"facingModeUser"===e.value?t.exact_facing_mode(c.FacingMode.User):"facingModeEnvironment"===e.value?t.exact_facing_mode(c.FacingMode.Environment):t.device_id(e.value),n.device_video(t),v.checked&&n.display_video(new c.DisplayVideoTrackConstraints)}else n.device_video(new c.DeviceVideoTrackConstraints)}return n}try{y.addEventListener("change",async()=>{try{let e=await O(y,x);for(const e of o)e.ptr>0&&e.free();h||(e=await T()),await I.set_local_media_settings(e,!1,!0)}catch(e){console.error("Changing audio source failed: "+e)}});let n=async()=>{try{let e=await O(y,x);for(const e of o)e.ptr>0&&e.free();try{t||await T(),await I.set_local_media_settings(e,!0,!0)}catch(e){let t=e.kind();if("RecoveredException"===t)alert("MediaStreamSettings set failed and current MediaStreamSettings was successfully recovered.");else if("RecoverFailedException"===t){alert("MediaStreamSettings set failed and MediaStreamSettings recovery failed.");for(const t of e.recover_fail_reasons())console.error('Name: "'+t.name()+'";\nMessage: "'+t.message()+'";')}else"ErroredException"===t&&alert("Fatal error occurred while MediaStreamSettings update.");console.error("Changing video source failed: "+t)}}catch(e){console.error("Changing video source failed: "+e.message())}};x.addEventListener("change",n),v.addEventListener("change",n),u.addEventListener("click",async()=>{try{if(h){await I.disable_audio();for(const e of o)e.ptr>0&&e.kind()===c.MediaKind.Audio&&e.ptr>0&&e.free();h=!1,u.textContent="Enable audio send"}else await I.enable_audio(),h=!0,u.textContent="Disable audio send",t||await T()}catch(e){console.error(e.message())}}),b.addEventListener("click",async()=>{try{if(E){await I.disable_video();for(const e of o)e.ptr>0&&e.kind()===c.MediaKind.Video&&e.ptr>0&&e.free();E=!1,b.textContent="Enable video send"}else await I.enable_video(),E=!0,b.textContent="Disable video send",t||await T()}catch(e){console.error(e.trace())}}),g.addEventListener("click",async()=>{try{L?(await I.unmute_audio(),L=!1,g.textContent="Mute audio send"):(await I.mute_audio(),L=!0,g.textContent="Unmute audio send")}catch(e){console.error(e.trace())}}),m.addEventListener("click",async()=>{try{S?(await I.unmute_video(),S=!1,m.textContent="Mute video send"):(await I.mute_video(),S=!0,m.textContent="Unmute video send")}catch(e){console.error(e.trace())}}),p.addEventListener("click",async()=>{N?(await I.disable_remote_audio(),N=!1,p.textContent="Enable audio recv"):(await I.enable_remote_audio(),N=!0,p.textContent="Disable audio recv")}),f.addEventListener("click",async()=>{M?(await I.disable_remote_video(),M=!1,f.textContent="Enable video recv"):(await I.enable_remote_video(),M=!0,f.textContent="Disable video recv")}),w.addEventListener("click",()=>{e.dispose()}),l.value=faker.name.firstName(),_.innerHTML=l.value,function(e){d.onclick=async function(){$("#connection-settings").modal("hide"),$(".control").css("display","flex"),$("#connect-btn").hide();try{let t=l.value;try{await axios.get(r+e)}catch(n){if(400===n.response.status)return console.log("Room not found. Creating new room..."),void await I.join(await async function(e,t){let n,o;n=document.getElementById("connection-settings__publish_audio").checked?"Optional":"Disabled",o=document.getElementById("connection-settings__publish_video").checked?"Optional":"Disabled";let a={};return document.getElementById("connection-settings__publish_is-enabled").checked&&(a.publish={kind:"WebRtcPublishEndpoint",p2p:"Never",force_relay:!1,audio_settings:{publish_policy:n},video_settings:{publish_policy:o}}),(await axios({method:"post",url:r+e,data:{kind:"Room",pipeline:{[t]:{kind:"Member",credentials:{plain:"test"},pipeline:a,on_join:"grpc://127.0.0.1:9099",on_leave:"grpc://127.0.0.1:9099"}}}})).data.sids[t]}(e,t));throw n}try{await axios.get(r+e+"/"+t)}catch(n){return console.log("Member not found. Creating new member..."),void await I.join(await async function(e,t){let n,o;n=document.getElementById("connection-settings__publish_audio").checked?"Optional":"Disabled",o=document.getElementById("connection-settings__publish_video").checked?"Optional":"Disabled";let a=document.getElementById("connection-settings__publish_is-enabled").checked,c=await axios.get(r+e),i=Object.values(c.data.element.pipeline),s={},d=[];a&&(s.publish={kind:"WebRtcPublishEndpoint",p2p:"Never",force_relay:!1,audio_settings:{publish_policy:n},video_settings:{publish_policy:o}});for(let t=0;t<i.length;t++){let n=i[t],o=n.id;d.push(o),n.pipeline.hasOwnProperty("publish")&&(s["play-"+o]={kind:"WebRtcPlayEndpoint",src:"local://"+e+"/"+o+"/publish",force_relay:!1})}let l=await axios({method:"post",url:r+e+"/"+t,data:{kind:"Member",credentials:{plain:"test"},pipeline:s,on_join:"grpc://127.0.0.1:9099",on_leave:"grpc://127.0.0.1:9099"}});if(a)try{for(let n=0;n<d.length;n++){let o=d[n];await axios({method:"post",url:r+e+"/"+o+"/play-"+t,data:{kind:"WebRtcPlayEndpoint",src:"local://"+e+"/"+t+"/publish",force_relay:!1}})}}catch(e){console.log(e.response)}return l.data.sids[t]}(e,t))}await I.join(a+e+"/"+t+"?token=test")}catch(e){console.error(e),console.error("Join to room failed: Error[name:[",e.kind(),"], ","[msg:",e.message(),"], [source",e.cause(),"]]"),console.error(e.trace())}}}(i)}catch(e){console.log(e)}};const N={createRoom:async function(e){try{await axios({method:"post",url:r+e,data:{kind:"Room",pipeline:{}}})}catch(e){alert(JSON.stringify(e.response.data))}},createMember:async function(e,t,n){n.kind="Member",n.pipeline={};try{await axios({method:"post",url:r+e+"/"+t,data:n})}catch(e){alert(JSON.stringify(e.response.data))}},createEndpoint:async function(e,t,n,o){try{return await axios({method:"post",url:r+e+"/"+t+"/"+n,data:o}),!0}catch(e){return alert(JSON.stringify(e.response.data)),!1}},getUrlForElement:function(e,t,n){let o=r+e;return t.length>0&&n.length>0?o=r+e+"/"+t+"/"+n:t.length>0&&(o=r+e+"/"+t),o},delete:async function(e,t,n){try{let o=N.getUrlForElement(e,t,n),r=await axios.delete(o);return JSON.stringify(r.data,null,4)}catch(e){alert(JSON.stringify(e.response.data))}},get:async function(e,t,n){try{let o=N.getUrlForElement(e,t,n);return(await axios.get(o)).data}catch(e){alert(JSON.stringify(e.response.data))}},getCallbacks:async function(){try{return(await axios.get(o+"/callbacks")).data}catch(e){alert(JSON.stringify(e.response.data))}}}}]);