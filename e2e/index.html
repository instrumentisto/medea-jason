<html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
  <title>Medea's E2E test</title>
  <script type="module">
    import init from "/pkg/medea_jason.js";

    // Override logging functions so logs are appended to a global variable
    // that can be later accessed by the test runner.
    function logOverride(message, level) {
      window.e2eLogs += level + ": " + message + "\n";
    };
    console.error = function(m) {
      logOverride(m, "E");
    }
    console.debug = function(m) {
      logOverride(m, "D");
    }
    console.info = function(m) {
      logOverride(m, "I");
    }
    console.log = function(m) {
      logOverride(m, "L");
    }

    window.originalWs = WebSocket;
    let oldProto = WebSocket.prototype;
    WebSocket = function(url) {
        return window.wsConstructor(url);
    };
    WebSocket.prototype = oldProto;

    window.onload = async () => {
      await init();
      window.rust = await import("/pkg/medea_jason.js");
      let loadedDiv = document.createElement('div');
      loadedDiv.id = 'loaded';
      document.body.appendChild(loadedDiv);
    }
  </script>
</head>
<body></body>
</html>
